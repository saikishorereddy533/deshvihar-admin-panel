<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitlife - Work Hard To Get Better Life</title>
  
    <!-- 
      - favicon
    -->
    <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">
  
    <!-- 
      - custom css link
    -->
    <link rel="stylesheet" href="/css/style.css">
  
    <!-- 
      - google font link
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Catamaran:wght@600;700;800;900&family=Rubik:wght@400;500;800&display=swap"
      rel="stylesheet">

      <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->
  
    <!-- 
      - preload images
    -->
    <link rel="preload" as="image" href="/images/hero-banner.png">
    <link rel="preload" as="image" href="/images/hero-circle-one.png">
    <link rel="preload" as="image" href="/images/hero-circle-two.png">
    <link rel="preload" as="image" href="/images/heart-rate.svg">
    <link rel="preload" as="image" href="/images/calories.svg">

    <style>
        /* members.css */

        .members-list-section{
            background-color: hsl(210, 50%, 4%);
        }
        /* Style the list title */
        .list-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #ccc; /* Choose your desired text color */
        }

        /* Style the table */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #f5f5f5; /* Choose your desired background color */
            border: 1px solid #ccc; /* Choose your desired border color */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add a subtle box shadow */
            border-radius: 8px; /* Add rounded corners */
        }

        /* Style table headers */
        table th {
            background-color: #333; /* Choose your desired header background color */
            color: #fff; /* Choose your desired header text color */
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        /* Style table cells */
        table td {
            padding: 12px;
            border-bottom: 1px solid #ccc; /* Add a border to separate rows */
        }

        /* Style alternating rows for better readability */
        table tr:nth-child(even) {
            background-color: #f9f9f9; /* Choose your desired background color */
        }

        /* Style the back-to-top button */
        .back-top-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #333; /* Choose your desired button background color */
            color: #fff; /* Choose your desired button text color */
            border: none;
            border-radius: 50%;
            padding: 12px;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-top-btn:hover {
            background-color: #555; /* Change color on hover */
        }

        /* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
}

.modal-dialog {
    margin: 15% auto;
    width: 65%;
}

.modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.modal-header,
.modal-body,
.modal-footer {
    padding: 10px;
}

.modal-title {
    font-size: 18px;
}

.btn-close {
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.btn-close:hover,
.btn-close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

.form-select,
.form-control {
    display: block;
    width: 100%;
    padding: .375rem .75rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: .25rem;
}

.btn {
    display: inline-block;
    font-weight: 400;
    text-align: center;
    vertical-align: middle;
    cursor: pointer;
    padding: .375rem .75rem;
    font-size: 1rem;
    line-height: 1.5;
}

.btn-secondary {
   color:#fff; 
   background-color:#6c757d; 
   border-color:#6c757d
}

.btn-primary {
   color:#fff; 
   background-color:#007bff; 
   border-color:#007bff
}

    </style>
</head>

<body id="top">

    <!-- Include the NavBar component -->
    <%- include('../../includes/navbar.ejs') %>

    <main>
        <section class="section members-list-section">
            <div class="container">
                <h1 class="list-title">Members List</h1>
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Package</th>
                            <th>Phone Number</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% members.forEach(member => { %>
                            <tr>
                                <td><%= member.name %></td>
                                <td><%= member.membershipStartDate.toDateString() %></td>
                                <td><%= member.membershipEndDate.toDateString() %></td>
                                <td><%= member.package.name %></td>
                                <td><%= member.phoneNumber %></td>
                                <td>
                                    <a href="javascript:void(0);" onclick="showRenewalPopup('<%= member.name %>', '<%= member._id %>')">Renew</a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>           
        </section>
    </main>
    

    <!-- Include the Footer component -->
    <%- include('../../includes/footer.ejs') %>

        <!-- Bootstrap Modal for Renewal -->
        <div class="modal fade" id="renewalModal" tabindex="-1" aria-labelledby="renewalModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="renewalModalLabel">Renew Membership</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <select id="renewalPackage" class="form-select" onchange="updateEndDate()">
                            <!-- Populate package options here -->
                        </select>
                        <input type="date" id="renewalStartDate" class="form-control" oninput="updateEndDate()">
                        <input type="date" id="renewalEndDate" class="form-control" readonly>
                        <input type="number" id="renewalAmountPaid" class="form-control" placeholder="Amount Paid">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="handleRenewal()">Renew</button>
                    </div>
                </div>
            </div>
        </div>

    <a href="#top" class="back-top-btn" aria-label="back to top" data-back-top-btn>
        <ion-icon name="caret-up-sharp" aria-hidden="true"></ion-icon>
    </a>

     <!-- Bootstrap JS and Popper.js (required for Bootstrap's dropdowns and popovers) -->
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" ></script>
     <script src="https://cdn.jsdelivr.net/npm/popper.js@2.9.3/dist/umd/popper.min.js"></script>
  <script src="/js/script.js" defer></script>

  <!-- 
    - ionicon link
  -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <!-- Include SweetAlert library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    let fetchedPackages;
    const packageDropdown = document.getElementById('renewalPackage');

      function updateEndDate() {
        const selectedPackageId = document.getElementById('renewalPackage').value;
        const renewalStartDate = document.getElementById('renewalStartDate').value;
        const renewalEndDate = document.getElementById('renewalEndDate');

        // Get the selected package details (you need to populate this data when you fetch packages)
        const selectedPackage = fetchedPackages.find(package => package._id === selectedPackageId);

        if (renewalStartDate && selectedPackage) {
            const startDate = new Date(renewalStartDate);
            // Calculate the end date based on the selected package's number of days
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + selectedPackage.days);

            // Format the calculated end date as YYYY-MM-DD
            const formattedEndDate = endDate.toISOString().split('T')[0];

            // Set the calculated end date in the input field
            renewalEndDate.value = formattedEndDate;
        } else {
            renewalEndDate.value = '';
        }
    }
    
    // Function to show the renewal modal
    function showRenewalPopup(name, memberId) {
        // Fetch packages and populate the dropdown
        fetch('/get-packages')
            .then(response => response.json())
            .then(packages => {
                fetchedPackages = packages;
                // Store the packages for later use
                window.packages = packages;
                packageDropdown.innerHTML = '';
                packages.forEach(package => {
                    const option = document.createElement('option');
                    option.value = package._id;
                    option.textContent = package.name;
                    packageDropdown.appendChild(option);
                });

                // Set the selected member's name in the modal title
                document.getElementById('renewalModalLabel').textContent = `Renew Membership for ${name}`;

                // Show the modal
                $('#renewalModal').modal('show');
            })
            .catch(error => {
                Swal.fire({
                    title: 'Error',
                    text: 'An error occurred while fetching packages.',
                    icon: 'error',
                });
            });
    }

    // Function to handle the renewal when the "Renew" button is clicked
    function handleRenewal() {
        const renewalPackage = document.getElementById('renewalPackage').value;
        const renewalStartDate = document.getElementById('renewalStartDate').value;
        const renewalEndDate = document.getElementById('renewalEndDate').value;
        const renewalAmountPaid = document.getElementById('renewalAmountPaid').value;

        // You can send this data to your server via a fetch request
    }
</script>

</body>

</html>